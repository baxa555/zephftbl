<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Futbol Paketi Analitikleri | MÃ¼ÅŸteri Paneli</title>
    <link rel="stylesheet" href="styles-pro.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // JSONBin.io - Cloud JSON Storage (Free & Public)
        const JSONBIN_BASE_URL = 'https://api.jsonbin.io/v3/b';
        const CUSTOMERS_BIN_ID = '676c8d9bad19ca34f8c4e123'; // Demo bin ID
        const LOGS_BIN_ID = '676c8d9bad19ca34f8c4e124'; // Demo bin ID

        // Database operations using JSONBin.io
        class FirebaseDB {
            // Get all customers
            static async getCustomers() {
                try {
                    console.log('ðŸ”¥ Loading customers from JSONBin...');
                    const response = await fetch(`${JSONBIN_BASE_URL}/${CUSTOMERS_BIN_ID}/latest`, {
                        headers: {
                            'X-Master-Key': '$2a$10$demo.key.for.public.access.only'
                        }
                    });

                    if (!response.ok) {
                        throw new Error('Failed to fetch customers');
                    }

                    const result = await response.json();
                    const customers = result.record || [];
                    
                    console.log('âœ… Loaded', customers.length, 'customers from JSONBin');
                    return customers;
                } catch (error) {
                    console.error('JSONBin get customers error:', error);
                    // Fallback to localStorage
                    const localData = localStorage.getItem('footballCustomers');
                    if (localData) {
                        console.log('ðŸ“± Using localStorage fallback');
                        return JSON.parse(localData);
                    }
                    return this.getDefaultCustomers();
                }
            }

            // Add customer
            static async addCustomer(customerData) {
                try {
                    console.log('ðŸ”¥ Saving customer to JSONBin:', customerData.name);
                    
                    // First get current customers
                    const customers = await this.getCustomers();
                    
                    // Add new customer with ID
                    customerData.id = Date.now() + Math.random();
                    customerData.created_at = new Date().toISOString();
                    customers.push(customerData);
                    
                    // Update JSONBin
                    const response = await fetch(`${JSONBIN_BASE_URL}/${CUSTOMERS_BIN_ID}`, {
                        method: 'PUT',
                        headers: {
                            'Content-Type': 'application/json',
                            'X-Master-Key': '$2a$10$demo.key.for.public.access.only'
                        },
                        body: JSON.stringify(customers)
                    });

                    if (!response.ok) {
                        throw new Error('Failed to save customer');
                    }
                    
                    // Also save to localStorage as backup
                    localStorage.setItem('footballCustomers', JSON.stringify(customers));
                    
                    console.log('âœ… Customer saved to JSONBin successfully');
                    return { success: true, id: customerData.id };
                } catch (error) {
                    console.error('JSONBin save error:', error);
                    
                    // Fallback to localStorage only
                    const customers = JSON.parse(localStorage.getItem('footballCustomers') || '[]');
                    customerData.id = Date.now() + Math.random();
                    customers.push(customerData);
                    localStorage.setItem('footballCustomers', JSON.stringify(customers));
                    
                    console.log('ðŸ“± Saved to localStorage as fallback');
                    return { success: true, id: customerData.id };
                }
            }

            // Delete customer
            static async deleteCustomer(customerName) {
                try {
                    console.log('ðŸ”¥ Deleting customer from JSONBin:', customerName);
                    
                    // Get current customers
                    const customers = await this.getCustomers();
                    
                    // Remove customer
                    const filteredCustomers = customers.filter(c => c.name !== customerName);
                    
                    // Update JSONBin
                    const response = await fetch(`${JSONBIN_BASE_URL}/${CUSTOMERS_BIN_ID}`, {
                        method: 'PUT',
                        headers: {
                            'Content-Type': 'application/json',
                            'X-Master-Key': '$2a$10$demo.key.for.public.access.only'
                        },
                        body: JSON.stringify(filteredCustomers)
                    });

                    if (!response.ok) {
                        throw new Error('Failed to delete customer');
                    }
                    
                    // Also update localStorage
                    localStorage.setItem('footballCustomers', JSON.stringify(filteredCustomers));
                    
                    console.log('âœ… Customer deleted from JSONBin successfully');
                    return { success: true };
                } catch (error) {
                    console.error('JSONBin delete error:', error);
                    
                    // Fallback to localStorage only
                    const customers = JSON.parse(localStorage.getItem('footballCustomers') || '[]');
                    const filteredCustomers = customers.filter(c => c.name !== customerName);
                    localStorage.setItem('footballCustomers', JSON.stringify(filteredCustomers));
                    
                    console.log('ðŸ“± Deleted from localStorage as fallback');
                    return { success: true };
                }
            }

            // Get admin logs
            static async getAdminLogs() {
                try {
                    const response = await fetch(`${JSONBIN_BASE_URL}/${LOGS_BIN_ID}/latest`, {
                        headers: {
                            'X-Master-Key': '$2a$10$demo.key.for.public.access.only'
                        }
                    });

                    if (!response.ok) {
                        throw new Error('Failed to fetch logs');
                    }

                    const result = await response.json();
                    return result.record || [];
                } catch (error) {
                    console.error('JSONBin get logs error:', error);
                    return [];
                }
            }

            // Add admin log
            static async addAdminLog(logData) {
                try {
                    // Get current logs
                    const logs = await this.getAdminLogs();
                    
                    // Add new log
                    logData.id = Date.now() + Math.random();
                    logData.created_at = new Date().toISOString();
                    logs.push(logData);
                    
                    // Update JSONBin
                    await fetch(`${JSONBIN_BASE_URL}/${LOGS_BIN_ID}`, {
                        method: 'PUT',
                        headers: {
                            'Content-Type': 'application/json',
                            'X-Master-Key': '$2a$10$demo.key.for.public.access.only'
                        },
                        body: JSON.stringify(logs)
                    });
                    
                    return { success: true };
                } catch (error) {
                    console.error('JSONBin add log error:', error);
                    return { success: false, error: error.message };
                }
            }
            
            // Get default customers
            static getDefaultCustomers() {
                return [
                    {
                        id: Date.now(),
                        name: "berataep",
                        platform: "telegram", 
                        purchaseDate: "02.09.25",
                        type: "sÄ±nÄ±rsÄ±z",
                        package: "GS Premium",
                        revenue: 3588,
                        endDate: null,
                        remainingDays: null,
                        status: "active",
                        created_at: new Date().toISOString()
                    }
                ];
            }
        }

        window.FirebaseDB = FirebaseDB;
        console.log('ðŸ”¥ JSONBin Database initialized successfully');
    </script>
    <script src="firebase-handler.js"></script>
    <script src="json-handler.js"></script>
</head>
<body>
    <div class="loading-screen" id="loadingScreen">
        <div class="loader">
            <div class="spinner"></div>
            <p>Futbol Paketi Paneli YÃ¼klÃ¼yor...</p>
        </div>
    </div>

    <nav class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <div class="logo-container">
                <img src="logo.png" alt="Zeph Logo" class="logo">
                <div class="brand-info">
                    <h3>Football</h3>
                    <span>Dashboard</span>
                </div>
            </div>
            <button class="sidebar-toggle" id="sidebarToggle">
                <i class="fas fa-bars"></i>
            </button>
        </div>

        <div class="nav-menu">
            <div class="nav-section">
                <h4>DASHBOARD</h4>
                <ul>
                    <li class="nav-item active" data-section="overview">
                        <i class="fas fa-chart-line"></i>
                        <span>Genel BakÄ±ÅŸ</span>
                    </li>
                    <li class="nav-item" data-section="customers">
                        <i class="fas fa-users"></i>
                        <span>MÃ¼ÅŸteriler</span>
                        <span class="badge" id="customerCount">0</span>
                    </li>
                </ul>
            </div>

            <div class="nav-section">
                <h4>YÃ–NETÄ°M</h4>
                <ul>
                    <li class="nav-item" data-section="subscriptions">
                        <i class="fas fa-credit-card"></i>
                        <span>Abonelik YÃ¶netimi</span>
                    </li>
                    <li class="nav-item" data-section="reports">
                        <i class="fas fa-clock"></i>
                        <span>Son Aktiviteler</span>
                    </li>
                    <li class="nav-item" data-section="admin-logs">
                        <i class="fas fa-user-shield"></i>
                        <span>Admin LoglarÄ±</span>
                    </li>
                </ul>
            </div>
        </div>

        <div class="sidebar-footer">
            <div class="user-info">
                <div class="user-avatar">
                    <i class="fas fa-user"></i>
                </div>
                <div class="user-details">
                    <p>YÃ¶netici</p>
                    <small>Ã‡evrimiÃ§i</small>
                </div>
            </div>
        </div>
    </nav>

    <main class="main-content">
        <header class="top-bar">
            <div class="top-bar-left">
                <button class="mobile-menu-toggle" id="mobileMenuToggle">
                    <i class="fas fa-bars"></i>
                </button>
                <div class="page-title">
                    <h1 id="pageTitle">Genel BakÄ±ÅŸ</h1>
                    <p id="pageSubtitle">GerÃ§ek zamanlÄ± abonelik analitikleri ve mÃ¼ÅŸteri yÃ¶netimi</p>
                </div>
            </div>
            <div class="top-bar-right">
                <div class="search-box">
                    <i class="fas fa-search"></i>
                    <input type="text" placeholder="MÃ¼ÅŸteri ara..." id="globalSearch">
                </div>
                <div class="notifications">
                    <button class="notification-btn">
                        <i class="fas fa-bell"></i>
                        <span class="notification-badge">3</span>
                    </button>
                </div>
                <div class="date-time">
                    <span id="currentDateTime"></span>
                </div>
            </div>
        </header>

        <div class="content-area">
            <!-- Overview Section -->
            <section class="section active" id="overview">
                <div class="dashboard-grid">
                    <!-- KPI Cards -->
                    <div class="kpi-section">
                        <div class="kpi-card primary">
                            <div class="kpi-header">
                                <h3>Toplam Gelir</h3>
                                <i class="fas fa-dollar-sign"></i>
                            </div>
                            <div class="kpi-value">
                                <span id="totalRevenue">â‚º0</span>
                                <small class="trend positive">
                                    <i class="fas fa-arrow-up"></i> +12.5%
                                </small>
                            </div>
                        </div>

                        <div class="kpi-card success">
                            <div class="kpi-header">
                                <h3>Aktif Aboneler</h3>
                                <i class="fas fa-users"></i>
                            </div>
                            <div class="kpi-value">
                                <span id="activeSubscribers">0</span>
                                <small class="trend positive">
                                    <i class="fas fa-arrow-up"></i> +8.3%
                                </small>
                            </div>
                        </div>

                        <div class="kpi-card warning">
                            <div class="kpi-header">
                                <h3>YakÄ±nda Bitenler</h3>
                                <i class="fas fa-exclamation-triangle"></i>
                            </div>
                            <div class="kpi-value">
                                <span id="expiringSoon">0</span>
                                <small class="trend negative">
                                    <i class="fas fa-arrow-down"></i> -2.1%
                                </small>
                            </div>
                        </div>

                        <div class="kpi-card info">
                            <div class="kpi-header">
                                <h3>DÃ¶nÃ¼ÅŸÃ¼m OranÄ±</h3>
                                <i class="fas fa-percentage"></i>
                            </div>
                            <div class="kpi-value">
                                <span id="conversionRate">94.2%</span>
                                <small class="trend positive">
                                    <i class="fas fa-arrow-up"></i> +1.8%
                                </small>
                            </div>
                        </div>
                    </div>

                    <!-- Customer Management Section -->
                    <div class="customer-management-section">
                        <div class="management-container">
                            <div class="management-header">
                                <h3><i class="fas fa-user-plus"></i> MÃ¼ÅŸteri YÃ¶netimi</h3>
                            </div>
                            <div class="management-actions">
                                <button class="btn-primary" onclick="zeph.showAddCustomerModal()">
                                    <i class="fas fa-plus"></i>
                                    Yeni MÃ¼ÅŸteri Ekle
                                </button>
                                <button class="btn-secondary" onclick="zeph.showDeleteCustomerModal()">
                                    <i class="fas fa-trash"></i>
                                    MÃ¼ÅŸteri Sil
                                </button>
                            </div>
                        </div>

                        <div class="chart-container">
                            <div class="chart-header">
                                <h3>Paket DaÄŸÄ±lÄ±mÄ±</h3>
                            </div>
                            <canvas id="packageChart"></canvas>
                        </div>
                    </div>

                </div>
            </section>

            <!-- Customers Section -->
            <section class="section" id="customers">
                <div class="customers-header">
                    <div class="filters-bar">
                        <div class="filter-group">
                            <button class="filter-btn active" data-filter="all">TÃ¼m MÃ¼ÅŸteriler</button>
                            <button class="filter-btn" data-filter="unlimited">SÄ±nÄ±rsÄ±z</button>
                            <button class="filter-btn" data-filter="seasonal">Sezonluk</button>
                            <button class="filter-btn" data-filter="monthly">AylÄ±k</button>
                            <button class="filter-btn" data-filter="expiring">SÃ¼resi Doluyor</button>
                        </div>
                        <div class="view-controls">
                            <button class="view-btn active" data-view="table">
                                <i class="fas fa-table"></i>
                            </button>
                            <button class="view-btn" data-view="cards">
                                <i class="fas fa-th-large"></i>
                            </button>
                        </div>
                    </div>
                </div>

                <div class="data-table-container">
                    <div class="table-controls">
                        <div class="entries-control">
                            <label>GÃ¶ster 
                                <select id="entriesPerPage">
                                    <option value="10">10</option>
                                    <option value="25" selected>25</option>
                                    <option value="50">50</option>
                                    <option value="100">100</option>
                                </select>
                                kayÄ±t
                            </label>
                        </div>
                        <div class="table-search">
                            <input type="text" placeholder="MÃ¼ÅŸteri ara..." id="tableSearch">
                            <i class="fas fa-search"></i>
                        </div>
                    </div>

                    <div class="data-table-wrapper">
                        <table class="data-table" id="customersTable">
                            <thead>
                                <tr>
                                    <th class="sortable" data-sort="name">
                                        MÃ¼ÅŸteri <i class="fas fa-sort"></i>
                                    </th>
                                    <th class="sortable" data-sort="platform">
                                        Platform <i class="fas fa-sort"></i>
                                    </th>
                                    <th class="sortable" data-sort="package">
                                        Paket <i class="fas fa-sort"></i>
                                    </th>
                                    <th class="sortable" data-sort="purchaseDate">
                                        SatÄ±n Alma Tarihi <i class="fas fa-sort"></i>
                                    </th>
                                    <th class="sortable" data-sort="endDate">
                                        BitiÅŸ Tarihi <i class="fas fa-sort"></i>
                                    </th>
                                    <th class="sortable" data-sort="remaining">
                                        Kalan GÃ¼n <i class="fas fa-sort"></i>
                                    </th>
                                    <th>Durum</th>
                                    <th>Ä°ÅŸlemler</th>
                                </tr>
                            </thead>
                            <tbody id="customersTableBody">
                            </tbody>
                        </table>
                    </div>

                    <div class="table-footer">
                        <div class="table-info">
                            <span id="tableInfo">Showing 1 to 25 of 42 entries</span>
                        </div>
                        <div class="pagination" id="pagination">
                        </div>
                    </div>
                </div>
            </section>

            <!-- Abonelik YÃ¶netimi Section -->
            <section class="section" id="subscriptions">
                <div class="subscriptions-header">
                    <h2>Abonelik YÃ¶netimi</h2>
                    <button class="btn-primary">
                        <i class="fas fa-plus"></i>
                        Yeni Abonelik Ekle
                    </button>
                </div>
                <div class="subscriptions-content">
                    <div class="subscription-types">
                        <div class="subscription-card unlimited">
                            <h3>SÄ±nÄ±rsÄ±z Paket</h3>
                            <div class="package-stats">
                                <span class="count" id="unlimitedCount">0</span>
                                <span class="label">Aktif KullanÄ±cÄ±</span>
                            </div>
                        </div>
                        <div class="subscription-card seasonal">
                            <h3>Sezonluk Paket</h3>
                            <div class="package-stats">
                                <span class="count" id="seasonalCount">0</span>
                                <span class="label">Aktif KullanÄ±cÄ±</span>
                            </div>
                        </div>
                        <div class="subscription-card monthly">
                            <h3>AylÄ±k Paket</h3>
                            <div class="package-stats">
                                <span class="count" id="monthlyCount">0</span>
                                <span class="label">Aktif KullanÄ±cÄ±</span>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Reports Section (Recent Activities) -->
            <section class="section" id="reports">
                <div class="reports-header">
                    <h2><i class="fas fa-clock"></i> Son Aktiviteler</h2>
                    <div class="report-actions">
                        <button class="btn-secondary" onclick="zeph.refreshActivities()">
                            <i class="fas fa-sync-alt"></i>
                            Yenile
                        </button>
                        <button class="btn-primary" onclick="zeph.exportActivities()">
                            <i class="fas fa-download"></i>
                            DÄ±ÅŸa Aktar
                        </button>
                    </div>
                </div>
                <div class="activities-content">
                    <div class="activities-grid" id="activitiesGrid">
                        <!-- Activities will be loaded here -->
                    </div>
                </div>
            </section>

            <!-- Admin Logs Section -->
            <section class="section" id="admin-logs">
                <div class="admin-logs-header">
                    <h2><i class="fas fa-user-shield"></i> Admin LoglarÄ±</h2>
                    <div class="admin-info">
                        <span>Aktif Admin: <strong id="currentAdmin"></strong></span>
                        <button class="btn-secondary" onclick="zeph.logout()">
                            <i class="fas fa-sign-out-alt"></i>
                            Ã‡Ä±kÄ±ÅŸ Yap
                        </button>
                    </div>
                </div>
                <div class="admin-logs-content">
                    <div class="logs-filters">
                        <button class="filter-btn active" onclick="zeph.filterLogs('all')">TÃ¼mÃ¼</button>
                        <button class="filter-btn" onclick="zeph.filterLogs('add')">Eklenen</button>
                        <button class="filter-btn" onclick="zeph.filterLogs('delete')">Silinen</button>
                        <button class="filter-btn" onclick="zeph.filterLogs('login')">GiriÅŸ</button>
                    </div>
                    <div class="logs-grid" id="adminLogsGrid">
                        <!-- Admin logs will be loaded here -->
                    </div>
                </div>
            </section>
        </div>
    </main>

    <!-- Login Modal -->
    <div class="login-overlay" id="loginOverlay">
        <div class="login-modal">
            <div class="login-header">
                <img src="logo.png" alt="Logo" class="login-logo">
                <h2>Futbol Paketi Paneli</h2>
                <p>Admin GiriÅŸi</p>
            </div>
            <form class="login-form" id="loginForm">
                <div class="form-group">
                    <label for="username">KullanÄ±cÄ± AdÄ±</label>
                    <input type="text" id="username" name="username" placeholder="KullanÄ±cÄ± adÄ±nÄ±zÄ± girin" required>
                </div>
                <div class="form-group">
                    <label for="password">Åžifre</label>
                    <input type="password" id="password" name="password" placeholder="Åžifrenizi girin" required>
                </div>
                <button type="submit" class="login-btn">
                    <i class="fas fa-sign-in-alt"></i>
                    GiriÅŸ Yap
                </button>
                <div class="login-error" id="loginError"></div>
            </form>
        </div>
    </div>

    <!-- Add Customer Modal -->
    <div class="modal-overlay" id="addCustomerModal">
        <div class="modal">
            <div class="modal-header">
                <h3>Yeni MÃ¼ÅŸteri Ekle</h3>
                <button class="modal-close" onclick="zeph.closeModal('addCustomerModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form class="modal-form" id="addCustomerForm">
                <div class="form-row">
                    <div class="form-group">
                        <label for="customerName">MÃ¼ÅŸteri AdÄ±</label>
                        <input type="text" id="customerName" name="customerName" required>
                    </div>
                    <div class="form-group">
                        <label for="platform">Platform</label>
                        <select id="platform" name="platform" required>
                            <option value="">SeÃ§in</option>
                            <option value="discord">Discord</option>
                            <option value="telegram">Telegram</option>
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="discordId">Discord/Telegram ID</label>
                        <input type="text" id="discordId" name="discordId" placeholder="Opsiyonel">
                    </div>
                    <div class="form-group">
                        <label for="purchaseDate">SatÄ±n Alma Tarihi</label>
                        <input type="text" id="purchaseDate" name="purchaseDate" placeholder="DD.MM.YY" required>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="packageType">Paket TÃ¼rÃ¼</label>
                        <select id="packageType" name="packageType" required>
                            <option value="">SeÃ§in</option>
                            <option value="sÄ±nÄ±rsÄ±z">SÄ±nÄ±rsÄ±z</option>
                            <option value="sezonluk">Sezonluk</option>
                            <option value="1 aylÄ±k">1 AylÄ±k</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="package">Paket</label>
                        <select id="package" name="package" required>
                            <option value="">SeÃ§in</option>
                            <option value="GS Premium">GS Premium</option>
                            <option value="FB Premium">FB Premium</option>
                            <option value="BJK Premium">BJK Premium</option>
                            <option value="Premium">Premium</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label for="note">Not</label>
                    <input type="text" id="note" name="note" placeholder="Opsiyonel not">
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn-secondary" onclick="zeph.closeModal('addCustomerModal')">Ä°ptal</button>
                    <button type="submit" class="btn-primary">MÃ¼ÅŸteriyi Ekle</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Delete Customer Modal -->
    <div class="modal-overlay" id="deleteCustomerModal">
        <div class="modal">
            <div class="modal-header">
                <h3>MÃ¼ÅŸteri Sil</h3>
                <button class="modal-close" onclick="zeph.closeModal('deleteCustomerModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-form">
                <div class="form-group">
                    <label for="deleteCustomerSelect">Silinecek MÃ¼ÅŸteriyi SeÃ§in</label>
                    <select id="deleteCustomerSelect" name="deleteCustomerSelect" required>
                        <option value="">MÃ¼ÅŸteri seÃ§in...</option>
                    </select>
                </div>
                <div class="delete-warning">
                    <i class="fas fa-exclamation-triangle"></i>
                    <p>Bu iÅŸlem geri alÄ±namaz! MÃ¼ÅŸteri kalÄ±cÄ± olarak silinecektir.</p>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn-secondary" onclick="zeph.closeModal('deleteCustomerModal')">Ä°ptal</button>
                    <button type="button" class="btn-danger" onclick="zeph.deleteSelectedCustomer()">MÃ¼ÅŸteriyi Sil</button>
                </div>
            </div>
        </div>
    </div>

    <script src="script-pro.js"></script>
</body>
</html>