<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Futbol Paketi Analitikleri | M√º≈üteri Paneli</title>
    <link rel="stylesheet" href="styles-pro.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // Vercel KV Database - Real cloud database 
        class FirebaseDB {
            // Get all customers
            static async getCustomers() {
                try {
                    console.log('üî• Loading customers from Vercel KV...');
                    
                    const response = await fetch('/api/kv-db?action=get-customers');
                    
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    
                    const customers = await response.json();
                    console.log('‚úÖ Loaded', customers.length, 'customers from Vercel KV');
                    
                    // Backup to localStorage
                    localStorage.setItem('footballCustomers', JSON.stringify(customers));
                    
                    return customers;
                } catch (error) {
                    console.error('Vercel KV error:', error);
                    
                    // Fallback to localStorage
                    const localData = localStorage.getItem('footballCustomers');
                    if (localData) {
                        console.log('üì± Using localStorage fallback');
                        return JSON.parse(localData);
                    }
                    
                    return this.getDefaultCustomers();
                }
            }

            // Add customer
            static async addCustomer(customerData) {
                try {
                    console.log('üî• Saving customer to Vercel KV:', customerData.name);
                    
                    const response = await fetch('/api/kv-db?action=add-customer', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(customerData)
                    });
                    
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    
                    const result = await response.json();
                    console.log('‚úÖ Customer saved to Vercel KV successfully');
                    
                    return result;
                } catch (error) {
                    console.error('Vercel KV save error:', error);
                    return { success: false, error: error.message };
                }
            }

            // Delete customer
            static async deleteCustomer(customerName) {
                try {
                    console.log('üî• Deleting customer from Vercel KV:', customerName);
                    
                    const response = await fetch('/api/kv-db?action=delete-customer', {
                        method: 'DELETE',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ name: customerName })
                    });
                    
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    
                    console.log('‚úÖ Customer deleted from Vercel KV successfully');
                    return { success: true };
                } catch (error) {
                    console.error('Vercel KV delete error:', error);
                    return { success: false, error: error.message };
                }
            }

            // Get admin logs
            static async getAdminLogs() {
                try {
                    const response = await fetch('/api/kv-db?action=get-logs');
                    
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    
                    const logs = await response.json();
                    return logs;
                } catch (error) {
                    console.error('Vercel KV logs error:', error);
                    return [];
                }
            }

            // Add admin log
            static async addAdminLog(logData) {
                try {
                    const response = await fetch('/api/kv-db?action=add-log', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(logData)
                    });
                    
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    
                    return { success: true };
                } catch (error) {
                    console.error('Vercel KV add log error:', error);
                    return { success: false, error: error.message };
                }
            }
            
            // Get default customers
            static getDefaultCustomers() {
                return [
                    {
                        id: Date.now(),
                        name: "berataep",
                        platform: "telegram", 
                        purchaseDate: "02.09.25",
                        type: "sƒ±nƒ±rsƒ±z",
                        package: "GS Premium",
                        revenue: 3588,
                        endDate: null,
                        remainingDays: null,
                        status: "active",
                        created_at: new Date().toISOString()
                    }
                ];
            }
        }

        window.FirebaseDB = FirebaseDB;
        console.log('üî• Vercel KV Database initialized successfully');
        console.log('üåç GLOBAL DATABASE: All admins share same data automatically!');
    </script>
    <script src="firebase-handler.js"></script>
    <script src="json-handler.js"></script>
</head>
<body>
    <div class="loading-screen" id="loadingScreen">
        <div class="loader">
            <div class="spinner"></div>
            <p>Futbol Paketi Paneli Y√ºkl√ºyor...</p>
        </div>
    </div>

    <nav class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <div class="logo-container">
                <img src="logo.png" alt="Zeph Logo" class="logo">
                <div class="brand-info">
                    <h3>Football</h3>
                    <span>Dashboard</span>
                </div>
            </div>
            <button class="sidebar-toggle" id="sidebarToggle">
                <i class="fas fa-bars"></i>
            </button>
        </div>

        <div class="nav-menu">
            <div class="nav-section">
                <h4>DASHBOARD</h4>
                <ul>
                    <li class="nav-item active" data-section="overview">
                        <i class="fas fa-chart-line"></i>
                        <span>Genel Bakƒ±≈ü</span>
                    </li>
                    <li class="nav-item" data-section="customers">
                        <i class="fas fa-users"></i>
                        <span>M√º≈üteriler</span>
                        <span class="badge" id="customerCount">0</span>
                    </li>
                </ul>
            </div>

            <div class="nav-section">
                <h4>Y√ñNETƒ∞M</h4>
                <ul>
                    <li class="nav-item" data-section="subscriptions">
                        <i class="fas fa-credit-card"></i>
                        <span>Abonelik Y√∂netimi</span>
                    </li>
                    <li class="nav-item" data-section="reports">
                        <i class="fas fa-clock"></i>
                        <span>Son Aktiviteler</span>
                    </li>
                    <li class="nav-item" data-section="admin-logs">
                        <i class="fas fa-user-shield"></i>
                        <span>Admin Loglarƒ±</span>
                    </li>
                </ul>
            </div>
        </div>

        <div class="sidebar-footer">
            <div class="user-info">
                <div class="user-avatar">
                    <i class="fas fa-user"></i>
                </div>
                <div class="user-details">
                    <p>Y√∂netici</p>
                    <small>√áevrimi√ßi</small>
                </div>
            </div>
        </div>
    </nav>

    <main class="main-content">
        <header class="top-bar">
            <div class="top-bar-left">
                <button class="mobile-menu-toggle" id="mobileMenuToggle">
                    <i class="fas fa-bars"></i>
                </button>
                <div class="page-title">
                    <h1 id="pageTitle">Genel Bakƒ±≈ü</h1>
                    <p id="pageSubtitle">Ger√ßek zamanlƒ± abonelik analitikleri ve m√º≈üteri y√∂netimi</p>
                </div>
            </div>
            <div class="top-bar-right">
                <div class="search-box">
                    <i class="fas fa-search"></i>
                    <input type="text" placeholder="M√º≈üteri ara..." id="globalSearch">
                </div>
                <div class="notifications">
                    <button class="notification-btn">
                        <i class="fas fa-bell"></i>
                        <span class="notification-badge">3</span>
                    </button>
                </div>
                <div class="date-time">
                    <span id="currentDateTime"></span>
                </div>
            </div>
        </header>

        <div class="content-area">
            <!-- Overview Section -->
            <section class="section active" id="overview">
                <div class="dashboard-grid">
                    <!-- KPI Cards -->
                    <div class="kpi-section">
                        <div class="kpi-card primary">
                            <div class="kpi-header">
                                <h3>Toplam Gelir</h3>
                                <i class="fas fa-dollar-sign"></i>
                            </div>
                            <div class="kpi-value">
                                <span id="totalRevenue">‚Ç∫0</span>
                                <small class="trend positive">
                                    <i class="fas fa-arrow-up"></i> +12.5%
                                </small>
                            </div>
                        </div>

                        <div class="kpi-card success">
                            <div class="kpi-header">
                                <h3>Aktif Aboneler</h3>
                                <i class="fas fa-users"></i>
                            </div>
                            <div class="kpi-value">
                                <span id="activeSubscribers">0</span>
                                <small class="trend positive">
                                    <i class="fas fa-arrow-up"></i> +8.3%
                                </small>
                            </div>
                        </div>

                        <div class="kpi-card warning">
                            <div class="kpi-header">
                                <h3>Yakƒ±nda Bitenler</h3>
                                <i class="fas fa-exclamation-triangle"></i>
                            </div>
                            <div class="kpi-value">
                                <span id="expiringSoon">0</span>
                                <small class="trend negative">
                                    <i class="fas fa-arrow-down"></i> -2.1%
                                </small>
                            </div>
                        </div>

                        <div class="kpi-card info">
                            <div class="kpi-header">
                                <h3>D√∂n√º≈ü√ºm Oranƒ±</h3>
                                <i class="fas fa-percentage"></i>
                            </div>
                            <div class="kpi-value">
                                <span id="conversionRate">94.2%</span>
                                <small class="trend positive">
                                    <i class="fas fa-arrow-up"></i> +1.8%
                                </small>
                            </div>
                        </div>
                    </div>

                    <!-- Customer Management Section -->
                    <div class="customer-management-section">
                        <div class="management-container">
                            <div class="management-header">
                                <h3><i class="fas fa-user-plus"></i> M√º≈üteri Y√∂netimi</h3>
                            </div>
                            <div class="management-actions">
                                <button class="btn-primary" onclick="zeph.showAddCustomerModal()">
                                    <i class="fas fa-plus"></i>
                                    Yeni M√º≈üteri Ekle
                                </button>
                                <button class="btn-secondary" onclick="zeph.showDeleteCustomerModal()">
                                    <i class="fas fa-trash"></i>
                                    M√º≈üteri Sil
                                </button>
                            </div>
                        </div>

                        <div class="chart-container">
                            <div class="chart-header">
                                <h3>Paket Daƒüƒ±lƒ±mƒ±</h3>
                            </div>
                            <canvas id="packageChart"></canvas>
                        </div>
                    </div>

                </div>
            </section>

            <!-- Customers Section -->
            <section class="section" id="customers">
                <div class="customers-header">
                    <div class="filters-bar">
                        <div class="filter-group">
                            <button class="filter-btn active" data-filter="all">T√ºm M√º≈üteriler</button>
                            <button class="filter-btn" data-filter="unlimited">Sƒ±nƒ±rsƒ±z</button>
                            <button class="filter-btn" data-filter="seasonal">Sezonluk</button>
                            <button class="filter-btn" data-filter="monthly">Aylƒ±k</button>
                            <button class="filter-btn" data-filter="expiring">S√ºresi Doluyor</button>
                        </div>
                        <div class="view-controls">
                            <button class="view-btn active" data-view="table">
                                <i class="fas fa-table"></i>
                            </button>
                            <button class="view-btn" data-view="cards">
                                <i class="fas fa-th-large"></i>
                            </button>
                        </div>
                    </div>
                </div>

                <div class="data-table-container">
                    <div class="table-controls">
                        <div class="entries-control">
                            <label>G√∂ster 
                                <select id="entriesPerPage">
                                    <option value="10">10</option>
                                    <option value="25" selected>25</option>
                                    <option value="50">50</option>
                                    <option value="100">100</option>
                                </select>
                                kayƒ±t
                            </label>
                        </div>
                        <div class="table-search">
                            <input type="text" placeholder="M√º≈üteri ara..." id="tableSearch">
                            <i class="fas fa-search"></i>
                        </div>
                    </div>

                    <div class="data-table-wrapper">
                        <table class="data-table" id="customersTable">
                            <thead>
                                <tr>
                                    <th class="sortable" data-sort="name">
                                        M√º≈üteri <i class="fas fa-sort"></i>
                                    </th>
                                    <th class="sortable" data-sort="platform">
                                        Platform <i class="fas fa-sort"></i>
                                    </th>
                                    <th class="sortable" data-sort="package">
                                        Paket <i class="fas fa-sort"></i>
                                    </th>
                                    <th class="sortable" data-sort="purchaseDate">
                                        Satƒ±n Alma Tarihi <i class="fas fa-sort"></i>
                                    </th>
                                    <th class="sortable" data-sort="endDate">
                                        Biti≈ü Tarihi <i class="fas fa-sort"></i>
                                    </th>
                                    <th class="sortable" data-sort="remaining">
                                        Kalan G√ºn <i class="fas fa-sort"></i>
                                    </th>
                                    <th>Durum</th>
                                    <th>ƒ∞≈ülemler</th>
                                </tr>
                            </thead>
                            <tbody id="customersTableBody">
                            </tbody>
                        </table>
                    </div>

                    <div class="table-footer">
                        <div class="table-info">
                            <span id="tableInfo">Showing 1 to 25 of 42 entries</span>
                        </div>
                        <div class="pagination" id="pagination">
                        </div>
                    </div>
                </div>
            </section>

            <!-- Abonelik Y√∂netimi Section -->
            <section class="section" id="subscriptions">
                <div class="subscriptions-header">
                    <h2>Abonelik Y√∂netimi</h2>
                    <button class="btn-primary">
                        <i class="fas fa-plus"></i>
                        Yeni Abonelik Ekle
                    </button>
                </div>
                <div class="subscriptions-content">
                    <div class="subscription-types">
                        <div class="subscription-card unlimited">
                            <h3>Sƒ±nƒ±rsƒ±z Paket</h3>
                            <div class="package-stats">
                                <span class="count" id="unlimitedCount">0</span>
                                <span class="label">Aktif Kullanƒ±cƒ±</span>
                            </div>
                        </div>
                        <div class="subscription-card seasonal">
                            <h3>Sezonluk Paket</h3>
                            <div class="package-stats">
                                <span class="count" id="seasonalCount">0</span>
                                <span class="label">Aktif Kullanƒ±cƒ±</span>
                            </div>
                        </div>
                        <div class="subscription-card monthly">
                            <h3>Aylƒ±k Paket</h3>
                            <div class="package-stats">
                                <span class="count" id="monthlyCount">0</span>
                                <span class="label">Aktif Kullanƒ±cƒ±</span>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Reports Section (Recent Activities) -->
            <section class="section" id="reports">
                <div class="reports-header">
                    <h2><i class="fas fa-clock"></i> Son Aktiviteler</h2>
                    <div class="report-actions">
                        <button class="btn-secondary" onclick="zeph.refreshActivities()">
                            <i class="fas fa-sync-alt"></i>
                            Yenile
                        </button>
                        <button class="btn-primary" onclick="zeph.exportActivities()">
                            <i class="fas fa-download"></i>
                            Dƒ±≈üa Aktar
                        </button>
                    </div>
                </div>
                <div class="activities-content">
                    <div class="activities-grid" id="activitiesGrid">
                        <!-- Activities will be loaded here -->
                    </div>
                </div>
            </section>

            <!-- Admin Logs Section -->
            <section class="section" id="admin-logs">
                <div class="admin-logs-header">
                    <h2><i class="fas fa-user-shield"></i> Admin Loglarƒ±</h2>
                    <div class="admin-info">
                        <span>Aktif Admin: <strong id="currentAdmin"></strong></span>
                        <button class="btn-secondary" onclick="zeph.logout()">
                            <i class="fas fa-sign-out-alt"></i>
                            √áƒ±kƒ±≈ü Yap
                        </button>
                    </div>
                </div>
                <div class="admin-logs-content">
                    <div class="logs-filters">
                        <button class="filter-btn active" onclick="zeph.filterLogs('all')">T√ºm√º</button>
                        <button class="filter-btn" onclick="zeph.filterLogs('add')">Eklenen</button>
                        <button class="filter-btn" onclick="zeph.filterLogs('delete')">Silinen</button>
                        <button class="filter-btn" onclick="zeph.filterLogs('login')">Giri≈ü</button>
                    </div>
                    <div class="logs-grid" id="adminLogsGrid">
                        <!-- Admin logs will be loaded here -->
                    </div>
                </div>
            </section>
        </div>
    </main>

    <!-- Login Modal -->
    <div class="login-overlay" id="loginOverlay">
        <div class="login-modal">
            <div class="login-header">
                <img src="logo.png" alt="Logo" class="login-logo">
                <h2>Futbol Paketi Paneli</h2>
                <p>Admin Giri≈üi</p>
            </div>
            <form class="login-form" id="loginForm">
                <div class="form-group">
                    <label for="username">Kullanƒ±cƒ± Adƒ±</label>
                    <input type="text" id="username" name="username" placeholder="Kullanƒ±cƒ± adƒ±nƒ±zƒ± girin" required>
                </div>
                <div class="form-group">
                    <label for="password">≈ûifre</label>
                    <input type="password" id="password" name="password" placeholder="≈ûifrenizi girin" required>
                </div>
                <button type="submit" class="login-btn">
                    <i class="fas fa-sign-in-alt"></i>
                    Giri≈ü Yap
                </button>
                <div class="login-error" id="loginError"></div>
            </form>
        </div>
    </div>

    <!-- Add Customer Modal -->
    <div class="modal-overlay" id="addCustomerModal">
        <div class="modal">
            <div class="modal-header">
                <h3>Yeni M√º≈üteri Ekle</h3>
                <button class="modal-close" onclick="zeph.closeModal('addCustomerModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form class="modal-form" id="addCustomerForm">
                <div class="form-row">
                    <div class="form-group">
                        <label for="customerName">M√º≈üteri Adƒ±</label>
                        <input type="text" id="customerName" name="customerName" required>
                    </div>
                    <div class="form-group">
                        <label for="platform">Platform</label>
                        <select id="platform" name="platform" required>
                            <option value="">Se√ßin</option>
                            <option value="discord">Discord</option>
                            <option value="telegram">Telegram</option>
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="discordId">Discord/Telegram ID</label>
                        <input type="text" id="discordId" name="discordId" placeholder="Opsiyonel">
                    </div>
                    <div class="form-group">
                        <label for="purchaseDate">Satƒ±n Alma Tarihi</label>
                        <input type="text" id="purchaseDate" name="purchaseDate" placeholder="DD.MM.YY" required>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="packageType">Paket T√ºr√º</label>
                        <select id="packageType" name="packageType" required>
                            <option value="">Se√ßin</option>
                            <option value="sƒ±nƒ±rsƒ±z">Sƒ±nƒ±rsƒ±z</option>
                            <option value="sezonluk">Sezonluk</option>
                            <option value="1 aylƒ±k">1 Aylƒ±k</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="package">Paket</label>
                        <select id="package" name="package" required>
                            <option value="">Se√ßin</option>
                            <option value="GS Premium">GS Premium</option>
                            <option value="FB Premium">FB Premium</option>
                            <option value="BJK Premium">BJK Premium</option>
                            <option value="Premium">Premium</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label for="note">Not</label>
                    <input type="text" id="note" name="note" placeholder="Opsiyonel not">
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn-secondary" onclick="zeph.closeModal('addCustomerModal')">ƒ∞ptal</button>
                    <button type="submit" class="btn-primary">M√º≈üteriyi Ekle</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Delete Customer Modal -->
    <div class="modal-overlay" id="deleteCustomerModal">
        <div class="modal">
            <div class="modal-header">
                <h3>M√º≈üteri Sil</h3>
                <button class="modal-close" onclick="zeph.closeModal('deleteCustomerModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-form">
                <div class="form-group">
                    <label for="deleteCustomerSelect">Silinecek M√º≈üteriyi Se√ßin</label>
                    <select id="deleteCustomerSelect" name="deleteCustomerSelect" required>
                        <option value="">M√º≈üteri se√ßin...</option>
                    </select>
                </div>
                <div class="delete-warning">
                    <i class="fas fa-exclamation-triangle"></i>
                    <p>Bu i≈ülem geri alƒ±namaz! M√º≈üteri kalƒ±cƒ± olarak silinecektir.</p>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn-secondary" onclick="zeph.closeModal('deleteCustomerModal')">ƒ∞ptal</button>
                    <button type="button" class="btn-danger" onclick="zeph.deleteSelectedCustomer()">M√º≈üteriyi Sil</button>
                </div>
            </div>
        </div>
    </div>

    <script src="script-pro.js"></script>
</body>
</html>